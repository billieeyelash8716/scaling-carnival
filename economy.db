import sqlite3

DB_NAME = "economy.db"

def initialize_db():
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute(
        "CREATE TABLE IF NOT EXISTS economy (user_id TEXT PRIMARY KEY, coins INTEGER NOT NULL)"
    )
    conn.commit()
    conn.close()

def get_coins(user_id: str) -> int:
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT coins FROM economy WHERE user_id = ?", (user_id,))
    row = c.fetchone()
    conn.close()
    return row[0] if row else 0

def add_coins(user_id: str, amount: int):
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    current = get_coins(user_id)
    if current == 0:
        c.execute("INSERT INTO economy (user_id, coins) VALUES (?, ?)", (user_id, amount))
    else:
        c.execute("UPDATE economy SET coins = coins + ? WHERE user_id = ?", (amount, user_id))
    conn.commit()
    conn.close()

def remove_coins(user_id: str, amount: int) -> bool:
    current = get_coins(user_id)
    if current < amount:
        return False
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("UPDATE economy SET coins = coins - ? WHERE user_id = ?", (amount, user_id))
    conn.commit()
    conn.close()
    return True
